# Vue3 æ€§èƒ½ä¸ä½“ç§¯çº¦æŸ

> **é‡è¦æ€§**ï¼šâ­â­â­â­  
> ç»„ä»¶åº“çš„æ€§èƒ½ç›´æ¥å½±å“ç”¨æˆ·åº”ç”¨çš„æ€§èƒ½ã€‚

## æ€§èƒ½ç›®æ ‡

### ä½“ç§¯ç›®æ ‡
- **å•ä¸ªç»„ä»¶ï¼ˆæœªå‹ç¼©ï¼‰**ï¼š< 10KB
- **å•ä¸ªç»„ä»¶ï¼ˆgzipï¼‰**ï¼š< 3KB
- **å®Œæ•´åº“ï¼ˆgzipï¼‰**ï¼š< 100KB
- **é¦–å±å¯ç”¨ç»„ä»¶åŒ…**ï¼š< 30KB

### è¿è¡Œæ—¶ç›®æ ‡
- **ç»„ä»¶åˆå§‹åŒ–**ï¼š< 16ms
- **é¦–æ¬¡æ¸²æŸ“**ï¼š< 50ms
- **å“åº”äº¤äº’**ï¼š< 100ms
- **åˆ—è¡¨æ¸²æŸ“ï¼ˆ1000 é¡¹ï¼‰**ï¼š< 300ms

## å“åº”å¼æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘å“åº”å¼å¼€é”€

#### âœ… æ¨è
```typescript
// 1. éå“åº”å¼å¸¸é‡æ”¾åœ¨ setup å¤–
const STATIC_OPTIONS = ['a', 'b', 'c']
const DEFAULT_CONFIG = { ... }

// 2. ä½¿ç”¨ shallowRef å¤„ç†å¤§å¯¹è±¡
const largeData = shallowRef({ ... })

// 3. ä½¿ç”¨ markRaw æ ‡è®°ä¸éœ€è¦å“åº”å¼çš„å¯¹è±¡
const chart = markRaw(new Chart(...))

// 4. é¿å…ä¸å¿…è¦çš„ computed
// âŒ ä¸å¥½
const fullName = computed(() => `${props.firstName} ${props.lastName}`)
// âœ… æ›´å¥½ï¼šå¦‚æœ props æœ¬èº«å°±å¤Ÿç”¨ï¼Œç›´æ¥åœ¨ template ä¸­ä½¿ç”¨
<template>{{ firstName }} {{ lastName }}</template>

// 5. ä½¿ç”¨ readonly é˜²æ­¢æ„å¤–ä¿®æ”¹
const config = readonly(defaultConfig)
```

#### âŒ é¿å…
```typescript
// 1. è¿‡åº¦å“åº”å¼
const state = reactive({
  data: [ /* å¤§é‡æ•°æ® */ ],
  meta: { /* å¾ˆå°‘å˜åŒ–çš„å…ƒæ•°æ® */ }
})
// åº”è¯¥åˆ†ç¦»ï¼š
const data = shallowRef([])
const meta = { /* éå“åº”å¼ */ }

// 2. æ·±å±‚å“åº”å¼å¤§å¯¹è±¡
const deepData = reactive({
  level1: {
    level2: {
      level3: { /* å¾ˆæ·±çš„åµŒå¥— */ }
    }
  }
})

// 3. åœ¨ computed ä¸­åˆ›å»ºæ–°å¯¹è±¡/æ•°ç»„
const getList = computed(() => {
  return props.items.map(item => ({ ...item }))  // âŒ æ¯æ¬¡éƒ½åˆ›å»ºæ–°å¯¹è±¡
})
```

### 2. è®¡ç®—å±æ€§ä¼˜åŒ–

```typescript
// âœ… ç¼“å­˜æ˜‚è´µçš„è®¡ç®—
const expensiveValue = computed(() => {
  // å¤æ‚è®¡ç®—é€»è¾‘
  return heavyOperation(props.data)
})

// âœ… é¿å…åœ¨ computed ä¸­ä½¿ç”¨ Date.now() ç­‰éçº¯å‡½æ•°
// âŒ ä¸å¥½
const timestamp = computed(() => Date.now())  // æ¯æ¬¡è®¿é—®éƒ½ä¼šé‡æ–°è®¡ç®—
// âœ… æ›´å¥½
const timestamp = ref(Date.now())

// âœ… åˆç†æ‹†åˆ† computed
// âŒ ä¸å¥½ï¼šä¸€ä¸ª computed åšå¤ªå¤šäº‹
const allInOne = computed(() => {
  const a = heavyCalcA()
  const b = heavyCalcB()
  return { a, b }
})
// âœ… æ›´å¥½ï¼šåˆ†ç¦»ç‹¬ç«‹çš„è®¡ç®—
const resultA = computed(() => heavyCalcA())
const resultB = computed(() => heavyCalcB())
```

### 3. Watch ä¼˜åŒ–

```typescript
// âœ… ä½¿ç”¨ watchEffect è€Œé watchï¼ˆå½“éœ€è¦ç›‘å¬å¤šä¸ªæºæ—¶ï¼‰
watchEffect(() => {
  doSomething(props.a, props.b, props.c)
})

// âœ… åˆç†ä½¿ç”¨ flush æ—¶æœº
watch(source, callback, {
  flush: 'post'  // é»˜è®¤ï¼Œç»„ä»¶æ›´æ–°å
  // flush: 'pre'   // ç»„ä»¶æ›´æ–°å‰
  // flush: 'sync'  // åŒæ­¥è§¦å‘ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
})

// âœ… é¿å…ä¸å¿…è¦çš„æ·±åº¦ç›‘å¬
// âŒ ä¸å¥½
watch(() => props.data, callback, { deep: true })
// âœ… æ›´å¥½ï¼šåªç›‘å¬éœ€è¦çš„å±æ€§
watch(() => props.data.id, callback)

// âœ… åŠæ—¶æ¸…ç† watch
const stop = watch(source, callback)
onUnmounted(() => stop())
```

#### å¼‚æ­¥ Watch çš„æ€§èƒ½é™·é˜±

```typescript
// âŒ é—®é¢˜ï¼šå¿«é€Ÿå˜åŒ–å¯èƒ½å¯¼è‡´ç«æ€æ¡ä»¶
watch(searchText, async (newValue) => {
  const result = await fetchData(newValue)
  data.value = result  // âš ï¸ æ—§è¯·æ±‚å¯èƒ½è¦†ç›–æ–°ç»“æœ
})

// âœ… è§£å†³æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ watchDebounced
import { watchDebounced } from '@vueuse/core'

watchDebounced(
  searchText,
  async (newValue) => {
    const result = await fetchData(newValue)
    data.value = result
  },
  { debounce: 300 }
)

// âœ… è§£å†³æ–¹æ¡ˆ 2ï¼šå¤„ç†ç«æ€æ¡ä»¶
let latestToken = 0
watch(searchText, async (newValue) => {
  const token = ++latestToken
  const result = await fetchData(newValue)
  if (token === latestToken) {  // åªä½¿ç”¨æœ€æ–°ç»“æœ
    data.value = result
  }
})

// âœ… è§£å†³æ–¹æ¡ˆ 3ï¼šä½¿ç”¨ AbortController
let abortController: AbortController | null = null
watch(searchText, async (newValue) => {
  abortController?.abort()  // å–æ¶ˆä¹‹å‰çš„è¯·æ±‚
  abortController = new AbortController()
  
  try {
    const result = await fetchData(newValue, abortController.signal)
    data.value = result
  } catch (error) {
    if (error.name !== 'AbortError') throw error
  }
})
```

## æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘æ¸²æŸ“æ¬¡æ•°

```vue
<script setup lang="ts">
// âœ… ä½¿ç”¨ v-once æ¸²æŸ“é™æ€å†…å®¹
// âœ… ä½¿ç”¨ v-memo ç¼“å­˜å­æ ‘
// âœ… åˆç†ä½¿ç”¨ v-show vs v-if

const props = defineProps<{ items: Item[] }>()
const selectedId = ref<number>()
</script>

<template>
  <!-- âœ… é™æ€å†…å®¹ä½¿ç”¨ v-once -->
  <div v-once class="static-header">
    <h1>{{ title }}</h1>
  </div>

  <!-- âœ… ä½¿ç”¨ v-memo ä¼˜åŒ–åˆ—è¡¨é¡¹ -->
  <div
    v-for="item in items"
    :key="item.id"
    v-memo="[item.id === selectedId, item.name]"
  >
    {{ item.name }}
  </div>

  <!-- âœ… é¢‘ç¹åˆ‡æ¢ç”¨ v-show -->
  <div v-show="isVisible" class="toggle-content">
    é¢‘ç¹åˆ‡æ¢çš„å†…å®¹
  </div>

  <!-- âœ… æ¡ä»¶æ¸²æŸ“ç”¨ v-if -->
  <HeavyComponent v-if="shouldRender" />
</template>
```

### 2. v-for åˆ—è¡¨ä¼˜åŒ–

#### key çš„æ­£ç¡®ä½¿ç”¨

```vue
<script setup lang="ts">
// âœ… ç¡®ä¿æ¯ä¸ª item æœ‰å”¯ä¸€ ID
const items = computed(() => 
  props.rawItems.map(item => ({
    ...item,
    _key: `${item.type}-${item.id}` // æå‰è®¡ç®— key
  }))
)
</script>

<template>
  <!-- âœ… ä½¿ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ -->
  <div v-for="item in items" :key="item.id">
    {{ item.name }}
  </div>

  <!-- âŒ ä¸è¦ä½¿ç”¨ index -->
  <div v-for="(item, index) in items" :key="index">
    {{ item.name }}
  </div>

  <!-- âŒ ä¸è¦ä½¿ç”¨å¤æ‚è¡¨è¾¾å¼ -->
  <div v-for="item in items" :key="`${item.type}-${item.id}-${item.status}`">
    {{ item.name }}
  </div>
</template>
```

#### é¿å…åœ¨ v-for ä¸­è°ƒç”¨å‡½æ•°

```vue
<script setup lang="ts">
// âŒ ä¸å¥½ï¼šæ¯ä¸ª item æ¯æ¬¡æ¸²æŸ“éƒ½è°ƒç”¨
const formatDate = (date: string) => dayjs(date).format('YYYY-MM-DD')

// âœ… æ›´å¥½ï¼šæå‰è®¡ç®—
const items = computed(() => 
  props.items.map(item => ({
    ...item,
    formattedDate: dayjs(item.date).format('YYYY-MM-DD')
  }))
)
</script>

<template>
  <!-- âŒ ä¸å¥½ -->
  <div v-for="item in props.items" :key="item.id">
    {{ formatDate(item.date) }}
  </div>

  <!-- âœ… æ›´å¥½ -->
  <div v-for="item in items" :key="item.id">
    {{ item.formattedDate }}
  </div>
</template>
```

#### v-for ä¸ v-if ä¸è¦åŒæ—¶ä½¿ç”¨

```vue
<!-- âŒ ä¸å¥½ï¼šå…ˆæ¸²æŸ“æ‰€æœ‰ itemï¼Œå†è¿‡æ»¤ -->
<div v-for="item in items" v-if="item.visible" :key="item.id">
  {{ item.name }}
</div>

<!-- âœ… æ›´å¥½ï¼šæå‰è¿‡æ»¤ -->
<script setup lang="ts">
const visibleItems = computed(() => items.filter(item => item.visible))
</script>

<div v-for="item in visibleItems" :key="item.id">
  {{ item.name }}
</div>
```

#### å¤§åˆ—è¡¨æ€§èƒ½é˜ˆå€¼

```typescript
// ğŸ“Š æ€§èƒ½é˜ˆå€¼æŒ‡å¯¼

// âœ… 50-100 é¡¹ï¼šæ­£å¸¸æ¸²æŸ“
<div v-for="item in items" :key="item.id">
  {{ item.name }}
</div>

// âš ï¸ 100-500 é¡¹ï¼šè€ƒè™‘åˆ†é¡µæˆ–æ‡’åŠ è½½
const displayItems = computed(() => items.slice(0, currentPage * pageSize))

// ğŸ”´ 500+ é¡¹ï¼šå¿…é¡»ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰
```

### 3. è™šæ‹Ÿæ»šåŠ¨

```typescript
// âœ… å¤§åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
// å·²é›†æˆ vue-virt-list

import VirtList from 'vue-virt-list'

// å¯¹äºè¶…è¿‡ 500 é¡¹çš„åˆ—è¡¨ï¼Œå¿…é¡»ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
<VirtList :list="longList" :itemHeight="50">
  <template #default="{ item }">
    <div>{{ item.name }}</div>
  </template>
</VirtList>
```

### 4. å¼‚æ­¥ç»„ä»¶

```typescript
// âœ… å¤§å‹/ä½é¢‘ç»„ä»¶ä½¿ç”¨å¼‚æ­¥åŠ è½½
import { defineAsyncComponent } from 'vue'

const HeavyComponent = defineAsyncComponent(() =>
  import('./HeavyComponent.vue')
)

// âœ… å¸¦åŠ è½½çŠ¶æ€
const AsyncComp = defineAsyncComponent({
  loader: () => import('./Comp.vue'),
  loadingComponent: LoadingSpinner,
  delay: 200,
  timeout: 3000
})
```

## CSS æ ·å¼æ§åˆ¶ä¼˜åŒ–

### æ ¸å¿ƒåŸåˆ™

> **90% åœºæ™¯ï¼šç”¨ class æ§åˆ¶æ ·å¼**  
> **åªæœ‰"æ ·å¼æœ¬èº«æ˜¯è®¡ç®—ç»“æœ"æ—¶ï¼Œæ‰ç”¨ computed style**

### ä¸¤ç§æ–¹å¼çš„æœ¬è´¨å·®åˆ«

#### 1ï¸âƒ£ computed â†’ styleï¼ˆå†…è”æ ·å¼ï¼‰

```typescript
// ä½ åœ¨ã€Œè®¡ç®— CSS å€¼ã€
const boxStyle = computed(() => ({
  width: `${props.width}px`,
  height: `${props.height}px`,
  transform: `translateX(${offset.value}px)`
}))
```

```vue
<div :style="boxStyle" />
```

**æœ¬è´¨ï¼šæ•°æ®é©±åŠ¨æ ·å¼å€¼**ï¼ˆä¸æ˜¯çŠ¶æ€åˆ‡æ¢ï¼‰

---

#### 2ï¸âƒ£ çŠ¶æ€ â†’ classï¼ˆæ¨èï¼‰

```typescript
// ä½ åœ¨ã€Œè¡¨è¾¾çŠ¶æ€ã€
const boxClass = computed(() => ({
  'box--active': isActive.value,
  'box--disabled': disabled.value
}))
```

```vue
<div :class="boxClass" />
```

**æœ¬è´¨ï¼šè¯­ä¹‰åŒ–æ ·å¼æ§åˆ¶**

---

### âœ… ä»€ä¹ˆæ—¶å€™ã€Œå¿…é¡»ã€ç”¨ computed style

#### 1. æ ·å¼å€¼æ˜¯"æ•°å­¦ç»“æœ"

```typescript
// âœ… è¿›åº¦æ¡
const progressStyle = computed(() => ({
  width: `${percent.value}%`
}))

// âœ… æ‹–æ‹½ä½ç§»
const dragStyle = computed(() => ({
  transform: `translate3d(${x.value}px, ${y.value}px, 0)`
}))

// âœ… åŠ¨æ€åæ ‡
const positionStyle = computed(() => ({
  left: `${coords.x}px`,
  top: `${coords.y}px`
}))
```

**é€‚ç”¨åœºæ™¯**ï¼š
- è¿›åº¦æ¡ã€æ‹–æ‹½ã€åŠ¨ç”»
- Canvasã€æ—¶é—´è½´ã€åæ ‡ç³»ç»Ÿ
- ä»»ä½•éœ€è¦å®æ—¶è®¡ç®—åƒç´ å€¼çš„åœºæ™¯

---

#### 2. CSS æ— æ³•æå‰ç©·ä¸¾

```typescript
// âœ… ç”¨æˆ·è¾“å…¥çš„é¢œè‰²
const style = computed(() => ({
  backgroundColor: userColor.value
}))

// âœ… æ¥å£è¿”å›çš„å°ºå¯¸
const style = computed(() => ({
  width: any2px(apiWidth.value),
  height: any2px(apiHeight.value)
}))
```

**é€‚ç”¨åœºæ™¯**ï¼š
- é¢œè‰²ã€å°ºå¯¸ã€ä½ç½®æ˜¯ç”¨æˆ·è¾“å…¥æˆ–æ¥å£è¿”å›
- ä¸å¯èƒ½å†™ 1000 ä¸ª class æ¥ç©·ä¸¾

---

#### 3. é«˜æ€§èƒ½åŠ¨ç”»ï¼ˆtransform / translateï¼‰

```typescript
// âœ… ä½¿ç”¨ transform çš„åŠ¨ç”»
const style = computed(() => ({
  transform: `translate3d(${x.value}px, ${y.value}px, 0)`
}))
```

**åŸå› **ï¼štransform è§¦å‘ GPU åŠ é€Ÿï¼Œç”¨ class åè€Œæ›´æ…¢æ›´ä¹±

---

### âŒ ä»€ä¹ˆæ—¶å€™ã€Œä¸€å®šä¸è¦ã€ç”¨ computed style

#### 1. çŠ¶æ€åˆ‡æ¢ç±»æ ·å¼

```typescript
// âŒ ä¸æ¨è
const style = computed(() => ({
  color: isActive.value ? '#1677ff' : '#999'
}))

// âœ… æ¨è
const classes = computed(() => ({
  'is-active': isActive.value
}))
```

```vue
<div :class="classes" />
```

```css
.is-active {
  color: var(--lew-color-primary);
}
```

**åŸå› **ï¼š
- æ ·å¼è¯­ä¹‰ä¸¢å¤±
- éš¾ä»¥ç»´æŠ¤
- è®¾è®¡ç³»ç»Ÿæ— æ³•å¤ç”¨
- ä¸»é¢˜ç³»ç»Ÿæ— æ³•æ¥ç®¡

---

#### 2. å’Œè®¾è®¡è§„èŒƒå¼ºç»‘å®šçš„æ ·å¼

```typescript
// âŒ ä¸è¦è¿™æ ·å†™æŒ‰é’®æ ·å¼
const buttonStyle = computed(() => ({
  backgroundColor: props.type === 'primary' ? '#1677ff' : '#fff',
  color: props.type === 'primary' ? '#fff' : '#333',
  border: props.disabled ? '1px solid #d9d9d9' : 'none'
}))

// âœ… æ­£ç¡®å†™æ³•
const buttonClass = computed(() => [
  'lew-button',
  `lew-button-${props.type}`,
  {
    'is-disabled': props.disabled,
    'is-loading': loading.value
  }
])
```

**åº”è¯¥ç”¨ class çš„æ ·å¼**ï¼š
- æŒ‰é’®ä¸»è‰²ã€hoverã€focus
- ç¦ç”¨æ€ã€é”™è¯¯æ€
- æ‰€æœ‰å’Œè®¾è®¡è§„èŒƒç›¸å…³çš„æ ·å¼

---

#### 3. ç»„ä»¶åº“çš„å¯å¤ç”¨æ ·å¼

> **ç»„ä»¶åº“é‡Œæ»¥ç”¨ style = éå¸¸ä¸ä¸“ä¸š**

```typescript
// âŒ è¿™ä¼šå¯¼è‡´ï¼š
// - ä¸»é¢˜ç³»ç»Ÿæ— æ³•åˆ‡æ¢
// - Dark mode å´©æºƒ
// - ç”¨æˆ·æ— æ³•è¦†ç›–æ ·å¼
// - Tailwind / CSS Variables æ— æ³•æ¥ç®¡

const style = computed(() => ({
  padding: props.size === 'large' ? '12px 24px' : '8px 16px',
  fontSize: props.size === 'large' ? '16px' : '14px'
}))

// âœ… æ­£ç¡®åšæ³•
const classes = computed(() => [
  'lew-button',
  `lew-button--${props.size}`
])
```

```css
.lew-button--large {
  padding: var(--lew-button-padding-large);
  font-size: var(--lew-button-font-size-large);
}

.lew-button--medium {
  padding: var(--lew-button-padding-medium);
  font-size: var(--lew-button-font-size-medium);
}
```

---

### ğŸ”¥ ç»„ä»¶åº“é‡Œçš„ã€Œé»„é‡‘èŒƒå¼ã€

#### æ¨èç»“æ„

```typescript
// 1. class è¡¨è¾¾çŠ¶æ€å’Œç±»å‹
const classes = computed(() => [
  'lew-button',
  `lew-button--${props.type}`,
  `lew-button--${props.size}`,
  {
    'is-loading': loading.value,
    'is-disabled': disabled.value,
    'is-round': props.round,
    'is-circle': props.circle,
    'is-text': props.text,
    'is-block': props.block
  }
])

// 2. åªæŠŠã€Œæ•°å€¼å‹ã€åŠ¨æ€å€¼æ”¾åˆ° style
const style = computed(() => {
  const result: Record<string, string | undefined> = {}
  
  // åŠ¨æ€å®½åº¦
  if (props.block) {
    result.width = '100%'
  } else if (props.width) {
    result.width = any2px(props.width)
  }
  
  // CSS å˜é‡ï¼ˆç”¨äºæ·±åº¦å®šåˆ¶ï¼‰
  if (props.customColor) {
    result['--button-color'] = props.customColor
  }
  
  return result
})
```

```vue
<button :class="classes" :style="style">
  <slot>{{ text }}</slot>
</button>
```

```css
.lew-button {
  /* ä½¿ç”¨ CSS å˜é‡ä½œä¸ºæ¡¥æ¢ */
  background-color: var(--button-color, var(--lew-color-primary));
}

.lew-button--primary { ... }
.lew-button--danger { ... }
.is-loading { ... }
.is-disabled { ... }
```

---

#### CSS Variables ä½œä¸ºæ¡¥æ¢ï¼ˆå¼ºçƒˆæ¨èï¼‰

```typescript
// âœ… ä½¿ç”¨ CSS å˜é‡ä¼ é€’åŠ¨æ€å€¼
const style = computed(() => ({
  '--gap': any2px(props.gap),
  '--radius': any2px(props.radius),
  '--duration': `${props.duration}ms`
}))
```

```vue
<div class="lew-container" :style="style">
  <slot />
</div>
```

```css
.lew-container {
  gap: var(--gap, 8px);
  border-radius: var(--radius, 4px);
  transition-duration: var(--duration, 300ms);
}
```

**ä¼˜åŠ¿**ï¼š
- âœ… æ ·å¼é€»è¾‘åœ¨ CSS ä¸­ï¼ˆè¯­ä¹‰æ¸…æ™°ï¼‰
- âœ… æ”¯æŒä¸»é¢˜ç³»ç»Ÿ
- âœ… ç”¨æˆ·å¯ä»¥é€šè¿‡ CSS è¦†ç›–
- âœ… æ€§èƒ½æ›´å¥½ï¼ˆæµè§ˆå™¨ä¼˜åŒ–ï¼‰

---

### ä¸€çœ¼åˆ¤æ–­ç”¨å“ªä¸ªï¼ˆå®ç”¨å£è¯€ï¼‰

#### åˆ¤æ–­æ ‡å‡† 1ï¼šä½ æ˜¯ä¸æ˜¯åœ¨"ç®—å€¼"ï¼Ÿ

```typescript
// åœ¨ç®—å€¼ â†’ style
const style = computed(() => ({
  width: `${baseWidth.value + padding.value * 2}px`  // âœ…
}))

// ä¸åœ¨ç®—å€¼ â†’ class
const classes = computed(() => ({
  'is-active': isActive.value  // âœ…
}))
```

---

#### åˆ¤æ–­æ ‡å‡† 2ï¼šè¿™ä¸ªæ ·å¼æœ‰æ²¡æœ‰"åå­—"ï¼Ÿ

```typescript
// æœ‰åå­—ï¼ˆactive / disabled / errorï¼‰â†’ class
const classes = computed(() => ({
  'is-active': isActive.value,      // âœ… æœ‰è¯­ä¹‰
  'is-disabled': isDisabled.value,  // âœ… æœ‰è¯­ä¹‰
  'is-error': hasError.value        // âœ… æœ‰è¯­ä¹‰
}))

// æ²¡æœ‰åå­—ï¼ˆ20pxã€37%ã€x+10ï¼‰â†’ style
const style = computed(() => ({
  left: `${x.value + 10}px`,        // âœ… çº¯æ•°å€¼
  width: `${percent.value}%`        // âœ… çº¯æ•°å€¼
}))
```

---

#### åˆ¤æ–­æ ‡å‡† 3ï¼šCSS é…ç½®å¯¹è±¡æ˜¯å¦åº”è¯¥ç”¨ classï¼Ÿ

```typescript
// âŒ ä¸å¥½ï¼šé™æ€é…ç½®å¯¹è±¡ç”¨ computed style
const STATUS_PLACEMENT_CONFIG = {
  "top-left": { top: "-0.05rem", left: "-0.05rem" },
  "top-right": { top: "-0.05rem", right: "-0.05rem" },
  // ...
}

const dotStyle = computed(() => ({
  ...STATUS_PLACEMENT_CONFIG[props.placement],  // âŒ é™æ€é…ç½®ä¸åº”è¯¥ç”¨ style
  backgroundColor: STATUS_COLOR_CONFIG[props.status],
}))

// âœ… æ›´å¥½ï¼šé™æ€é…ç½®ç”¨ CSS classï¼ŒåªæŠŠåŠ¨æ€å€¼æ”¾ style
const statusDotClass = computed(() => 
  `lew-avatar-status-dot--${props.shape}-${props.placement}`
)

const statusDotStyle = computed(() => ({
  backgroundColor: STATUS_COLOR_CONFIG[props.status],  // âœ… åªä¿ç•™åŠ¨æ€å€¼
  width: any2px(dotSize),  // âœ… åŠ¨æ€è®¡ç®—çš„å€¼
}))
```

```css
/* âœ… CSS ä¸­å®šä¹‰é™æ€é…ç½® */
.lew-avatar-status-dot--circle-top-left {
  top: -0.05rem;
  left: -0.05rem;
}

.lew-avatar-status-dot--circle-top-right {
  top: -0.05rem;
  right: -0.05rem;
}
```

**åŸåˆ™**ï¼š
- **é™æ€é…ç½®**ï¼ˆä½ç½®ã€å›ºå®šå°ºå¯¸ï¼‰â†’ ç”¨ CSS class
- **åŠ¨æ€å€¼**ï¼ˆé¢œè‰²ã€è®¡ç®—å°ºå¯¸ï¼‰â†’ ç”¨ computed style
- **ç»„åˆä½¿ç”¨**ï¼šclass æ§åˆ¶ç»“æ„ï¼Œstyle æ§åˆ¶åŠ¨æ€å€¼

---

### æ€§èƒ½å¯¹æ¯”

#### computed style çš„æ€§èƒ½æˆæœ¬

```typescript
// âŒ æ¯æ¬¡ isActive å˜åŒ–éƒ½ä¼šè§¦å‘å†…è”æ ·å¼æ›´æ–°
const style = computed(() => ({
  color: isActive.value ? '#1677ff' : '#999',
  backgroundColor: isActive.value ? '#e6f7ff' : '#fff',
  borderColor: isActive.value ? '#1677ff' : '#d9d9d9'
}))

// âœ… åªæ˜¯åˆ‡æ¢ classï¼Œæµè§ˆå™¨ä½¿ç”¨ç¼“å­˜çš„æ ·å¼
const classes = computed(() => ({
  'is-active': isActive.value
}))
```

**æ€§èƒ½å·®å¼‚**ï¼š
- **computed style**ï¼šéœ€è¦é‡æ–°è§£æã€è®¡ç®—ã€åº”ç”¨æ ·å¼
- **class**ï¼šæµè§ˆå™¨ç›´æ¥ä½¿ç”¨ CSSOM ç¼“å­˜ï¼ˆå¿« 10-100 å€ï¼‰

---

### æ€»ç»“ï¼ˆä¸€å¥äººè¯ï¼‰

| ç”¨é€” | ä½¿ç”¨æ–¹å¼ | å…¸å‹åœºæ™¯ |
|------|---------|---------|
| **è¡¨è¾¾çŠ¶æ€** | class | active / disabled / loading / error |
| **è¡¨è¾¾ç±»å‹** | class | primary / danger / large / small |
| **è®¾è®¡ç³»ç»Ÿ** | class | æ‰€æœ‰è®¾è®¡è§„èŒƒå®šä¹‰çš„æ ·å¼ |
| **è®¡ç®—ç»“æœ** | style | è¿›åº¦æ¡ã€æ‹–æ‹½ã€åŠ¨ç”» |
| **åŠ¨æ€æ•°å€¼** | style | ç”¨æˆ·è¾“å…¥ã€API è¿”å›çš„å€¼ |
| **æ¡¥æ¢** | CSS Variables | å¯å®šåˆ¶çš„æ•°å€¼å‚æ•° |

**ç»„ä»¶åº“åŸåˆ™**ï¼š
- âœ… **class ä¸ºä¸»ï¼Œstyle ä¸ºè¾…**
- âœ… **çŠ¶æ€ç”¨ classï¼Œæ•°å€¼ç”¨ style**
- âœ… **CSS Variables æ˜¯æœ€å¥½çš„æ¡¥æ¢**

---

## ç»„ä»¶è®¾è®¡ä¼˜åŒ–

### 1. Props è®¾è®¡

```typescript
// âœ… ä½¿ç”¨åŸºç¡€ç±»å‹è€Œéå¯¹è±¡ï¼ˆå‡å°‘å“åº”å¼å¼€é”€ï¼‰
// âŒ ä¸å¥½
defineProps<{
  config: {
    size: string
    color: string
    disabled: boolean
  }
}>()
// âœ… æ›´å¥½
defineProps<{
  size: string
  color: string
  disabled: boolean
}>()

// âœ… é¿å… props ä¼ é€’å¤§å¯¹è±¡
// âŒ ä¸å¥½
defineProps<{
  data: LargeDataObject  // æ•´ä¸ªå¯¹è±¡éƒ½ä¼šè¢« Vue å¤„ç†
}>()
// âœ… æ›´å¥½ï¼šåªä¼ å¿…è¦çš„æ•°æ®
defineProps<{
  dataId: string
  dataName: string
}>()
```

### 2. Slots ä¼˜åŒ–

```vue
<script setup lang="ts">
// âœ… æ£€æµ‹ slot æ˜¯å¦å­˜åœ¨ï¼Œé¿å…ä¸å¿…è¦çš„æ¸²æŸ“
const slots = useSlots()
const hasFooter = computed(() => !!slots.footer)
</script>

<template>
  <!-- âŒ ä¸å¥½ï¼šæ€»æ˜¯æ¸²æŸ“åŒ…è£¹å…ƒç´  -->
  <div class="footer-wrapper">
    <slot name="footer" />
  </div>

  <!-- âœ… æ›´å¥½ï¼šæœ‰å†…å®¹æ‰æ¸²æŸ“ -->
  <div v-if="hasFooter" class="footer-wrapper">
    <slot name="footer" />
  </div>
</template>
```

### 3. äº‹ä»¶å¤„ç†

```vue
<script setup lang="ts">
// âœ… ä½¿ç”¨å‡½æ•°å¼•ç”¨è€Œéå†…è”ç®­å¤´å‡½æ•°ï¼ˆé¿å…é‡å¤åˆ›å»ºï¼‰
const handleClick = (e: MouseEvent) => {
  emit('click', e)
}

// âœ… é˜²æŠ–/èŠ‚æµ
import { useDebounceFn, useThrottleFn } from '@vueuse/core'

const debouncedSearch = useDebounceFn((value: string) => {
  // æœç´¢é€»è¾‘
}, 300)
</script>

<template>
  <!-- âŒ ä¸å¥½ï¼šæ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å‡½æ•° -->
  <button @click="() => emit('click')">Click</button>

  <!-- âœ… æ›´å¥½ï¼šä½¿ç”¨å‡½æ•°å¼•ç”¨ -->
  <button @click="handleClick">Click</button>

  <!-- âœ… ç®€å•æƒ…å†µå¯ä»¥å†…è” emit -->
  <button @click="emit('click', $event)">Click</button>
</template>
```

## æ ·å¼æ€§èƒ½ä¼˜åŒ–

### 1. CSS ä½œç”¨åŸŸ

```scss
// âœ… ä½¿ç”¨ scoped é¿å…å…¨å±€æ±¡æŸ“
<style lang="scss" scoped>
.lew-button {
  // ç»„ä»¶æ ·å¼
}
</style>

// âŒ é¿å…æ·±å±‚é€‰æ‹©å™¨åµŒå¥—ï¼ˆå½±å“æ€§èƒ½ï¼‰
// ä¸å¥½ï¼š
.lew-table {
  .lew-table-row {
    .lew-table-cell {
      .lew-table-cell-content {
        // 4 å±‚åµŒå¥—
      }
    }
  }
}
// æ›´å¥½ï¼š
.lew-table-cell-content {
  // ç›´æ¥å®šä½
}
```

### 2. CSS å˜é‡æ€§èƒ½

```scss
// âœ… åœ¨æ ¹å…ƒç´ å®šä¹‰å˜é‡
.lew-button {
  --lew-button-bg: transparent;
  --lew-button-color: var(--lew-color-primary);
  
  background: var(--lew-button-bg);
  color: var(--lew-button-color);
}

// âŒ é¿å…è¿‡åº¦ä½¿ç”¨ calc()
// ä¸å¥½ï¼š
width: calc(calc(100% - 20px) / 3 + 5px);
// æ›´å¥½ï¼šé¢„è®¡ç®—æˆ–ä½¿ç”¨ CSS Grid
```

### 3. åŠ¨ç”»æ€§èƒ½

```scss
// âœ… åªåŠ¨ç”» transform å’Œ opacity
.lew-button {
  transition: transform 0.2s, opacity 0.2s;
  
  &:hover {
    transform: translateY(-2px);
    opacity: 0.8;
  }
}

// âŒ é¿å…åŠ¨ç”»å¸ƒå±€å±æ€§
// ä¸å¥½ï¼š
transition: width 0.3s, height 0.3s, top 0.3s;

// âœ… ä½¿ç”¨ will-change æç¤ºæµè§ˆå™¨ï¼ˆè°¨æ…ï¼‰
.lew-dropdown {
  will-change: transform, opacity;
}
```

## æ‰“åŒ…ä½“ç§¯ä¼˜åŒ–

### 1. Tree-shaking å‹å¥½

```typescript
// âœ… ä½¿ç”¨å…·åå¯¼å‡º
export { LewButton }
export { LewInput }

// âŒ é¿å…æ•´ä½“å¯¼å‡º
// export default { LewButton, LewInput }

// âœ… é¿å…å¯¼å…¥æ•´ä¸ª lodash
// âŒ import _ from 'lodash'
// âœ… import { debounce } from 'lodash-es'

// âœ… æ¡ä»¶å¯¼å…¥
if (isDev) {
  const devTool = await import('./devTool')
}
```

### 2. ä¾èµ–ç®¡ç†

```typescript
// âœ… ä½¿ç”¨é¡¹ç›®å·²æœ‰çš„ä¾èµ–
import { useDebounce } from '@vueuse/core'  // âœ… é¡¹ç›®å·²å®‰è£…

// âŒ é¿å…å¼•å…¥é‡å¤åŠŸèƒ½çš„åŒ…
// import debounce from 'awesome-debounce'  // âŒ æ–°å¢ä¾èµ–

// âœ… å¯¹äºç®€å•åŠŸèƒ½ï¼Œè€ƒè™‘è‡ªå·±å®ç°
export function debounce<T extends (...args: any[]) => any>(
  fn: T,
  delay: number
): T {
  let timer: ReturnType<typeof setTimeout>
  return ((...args) => {
    clearTimeout(timer)
    timer = setTimeout(() => fn(...args), delay)
  }) as T
}
```

### 3. ä»£ç åˆ†å‰²

```typescript
// ç»„ä»¶åº“çš„ index.ts
// âœ… æ”¯æŒæŒ‰éœ€å¯¼å…¥
export { LewButton } from './button'
export { LewInput } from './input'

// ç”¨æˆ·å¯ä»¥ï¼š
import { LewButton } from 'lew-ui'  // åªæ‰“åŒ… Button
```

## æ€§èƒ½ç›‘æ§

### å¼€å‘æ—¶æ£€æŸ¥

```typescript
// âœ… å¼€å‘ç¯å¢ƒæ€§èƒ½æç¤º
if (process.env.NODE_ENV === 'development') {
  // æ£€æµ‹å¤§æ•°ç»„ prop
  if (Array.isArray(props.items) && props.items.length > 1000) {
    console.warn('[lew-ui] Large array detected. Consider using virtual scroll.')
  }
  
  // æ£€æµ‹æ·±å±‚ watch
  // ... æ€§èƒ½æç¤º
}
```

### æ€§èƒ½æµ‹è¯•

```typescript
// ä½¿ç”¨ Vitest è¿›è¡Œæ€§èƒ½æµ‹è¯•
import { describe, it, expect } from 'vitest'
import { mount } from '@vue/test-utils'

describe('Button Performance', () => {
  it('should render within 16ms', () => {
    const start = performance.now()
    mount(LewButton, { props: { text: 'Test' } })
    const end = performance.now()
    
    expect(end - start).toBeLessThan(16)
  })
})
```

## æ£€æŸ¥æ¸…å•

å®ç°ç»„ä»¶æ—¶ç¡®è®¤ï¼š
- [ ] é¿å…äº†ä¸å¿…è¦çš„å“åº”å¼æ•°æ®
- [ ] computed æœ‰åˆç†çš„ç¼“å­˜ç­–ç•¥
- [ ] å¤§åˆ—è¡¨ä½¿ç”¨äº†è™šæ‹Ÿæ»šåŠ¨
- [ ] ä½é¢‘/é‡å‹ç»„ä»¶ä½¿ç”¨å¼‚æ­¥åŠ è½½
- [ ] æ ·å¼åŠ¨ç”»åªä½¿ç”¨ transform/opacity
- [ ] æ²¡æœ‰å¼•å…¥ä¸å¿…è¦çš„ä¾èµ–
- [ ] æ”¯æŒ tree-shaking
- [ ] å¼€å‘ç¯å¢ƒæœ‰æ€§èƒ½æç¤º
- [ ] ç»„ä»¶ä½“ç§¯ç¬¦åˆç›®æ ‡ï¼ˆ< 10KBï¼‰
- [ ] **çŠ¶æ€åˆ‡æ¢ä½¿ç”¨ classï¼ˆä¸æ˜¯ computed styleï¼‰**
- [ ] **åªåœ¨è®¡ç®—æ•°å€¼æ—¶ä½¿ç”¨ style**
- [ ] **è®¾è®¡è§„èŒƒæ ·å¼éƒ½åœ¨ CSS ä¸­ï¼ˆä¸åœ¨ JSï¼‰**
- [ ] **ä½¿ç”¨ CSS Variables ä¼ é€’åŠ¨æ€å‚æ•°**

## æ€§èƒ½è°ƒè¯•å·¥å…·

```bash
# åˆ†ææ‰“åŒ…ä½“ç§¯
pnpm run analyze

# è¿è¡Œæ€§èƒ½æµ‹è¯•
pnpm run test:performance

# TypeScript ç±»å‹æ£€æŸ¥
pnpm run typecheck
```

---

**è®°ä½**ï¼šæ€§èƒ½ä¼˜åŒ–è¦åŸºäºå®é™…æµ‹é‡ï¼Œä¸è¦è¿‡æ—©ä¼˜åŒ–ï¼
